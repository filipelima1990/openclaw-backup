# 2026-02-14 - Database Deployment Test

**Time:** 2026-02-14 15:35 UTC

## Test Results

### ✅ All Tests Passed

| Environment | Database | Configuration | Data | Insert Test | Status |
|-------------|----------|---------------|-------|-------------|--------|
| **Housing DEV** | `portugal_houses_dev` | ✅ Correct | ✅ 185,562 listings | ✅ Working | ✅ PASS |
| **Housing PROD** | `portugal_houses_prod` | ✅ Correct | ✅ 185,562 listings | ✅ Working | ✅ PASS |
| **Football DEV** | `football_data_dev` | ✅ Correct | ✅ Schema ready | ✅ Working | ✅ PASS |
| **Football PROD** | `football_data_prod` | ✅ Correct | ✅ Schema ready | ✅ Working | ✅ PASS |

### Verification Details

**Housing Market:**
- Total listings: 185,562 (historical snapshots)
- Unique listings: 63,139 (latest snapshot view)
- Date range: 2026-02-11 to 2026-02-13
- Test insert: Successfully added and removed test records

**Football Data:**
- Schema: `raw_pl_matches` table created with indexes
- Dev database: Has additional test tables (13 total)
- Prod database: Clean with only `raw_pl_matches` (1 table)
- Test insert: Successfully added and removed test match

### Environment Files Verified

```bash
# Housing Market
/opt/portugal-house-market-dev/.env     → POSTGRES_DB=portugal_houses_dev  ✅
/opt/portugal-house-market/.env        → POSTGRES_DB=portugal_houses_prod ✅

# Football Data
/opt/football-data-dev/.env            → DB_NAME=football_data_dev         ✅
/opt/football-data/.env               → DB_NAME=football_data_prod        ✅
```

### Database Schemas

**Portugal Houses (both dev and prod):**
- `raw.listings` - All historical listings
- `raw.listings_latest` - Latest snapshot view
- `staging.price_history` - Price change tracking
- `marts` - Final analytics tables (ready for dbt)

**Football Data (both dev and prod):**
- `raw_pl_matches` - Premier League match data
- Indexes: match_date, home_team, away_team, league_division

### Prefect Integration

Both projects use the **shared Prefect server** at `/opt/prefect` (port 4200):
- Housing: `daily-scrape-porto-housing` deployment (9:00 AM UTC)
- Football: `weekly-load-premier-league` deployment (Sundays 10:00 AM UTC)

Deployments automatically read the correct database from `.env` files based on which directory they run from.

### Next Steps

1. ✅ Database separation completed
2. ✅ Data migration completed
3. ✅ Configuration verification completed
4. ✅ Insert tests passed
5. ⏭️ Deploy to production (merge PRs)
6. ⏭️ Test scheduled runs

---

**Status:** ✅ Ready for production deployment
