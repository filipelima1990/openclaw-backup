# 2026-02-12

## Football Betting Prediction System - Design Discussion

### Project Overview
- **Goal**: Build form-based prediction system for Premier League betting
- **Approach**: Analyze last 3-5 games per team to suggest bets (1X2, over/under goals, BTTS)
- **Project location**: `/opt/football-odds-scraper/` (generic name for future league expansion)

### Data Sources - Hybrid Architecture

**football-data.org API** (for match results):
- Premier League is FREE forever (confirmed)
- Rate limit: 10 requests/minute for registered clients (free plan)
- Provides: match results, scores, dates, teams, status, basic odds (1x2 only)
- Limitations: No over/under, no BTTS odds, no odds history, no multiple bookmakers
- Endpoints: `/v4/matches` with filters (competitions=PL, status=FINISHED/SCHEDULED, dateFrom, dateTo)
- Requires API token (free registration)

**OddsHarvester** (for betting odds):
- Scrapes from oddsportal.com
- Provides: Detailed betting odds (1x2, over/under, BTTS, etc.) from multiple bookmakers
- Commands: `oddsharvester upcoming` and `oddsharvester historic`
- No odds history available currently

### Proposed Postgres Schema

```sql
-- Matches (from football-data.org)
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    match_id INT UNIQUE,  -- football-data.org ID
    home_team VARCHAR(100) NOT NULL,
    away_team VARCHAR(100) NOT NULL,
    kickoff TIMESTAMP NOT NULL,
    league VARCHAR(20) DEFAULT 'PL',
    status VARCHAR(20) NOT NULL,  -- FINISHED, SCHEDULED
    home_score INT,
    away_score INT,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Odds (from OddsHarvester)
CREATE TABLE match_odds (
    id SERIAL PRIMARY KEY,
    match_id INT REFERENCES matches(match_id),
    bookmaker VARCHAR(50),
    market VARCHAR(50),  -- 1x2, over_under, btts
    selection VARCHAR(10),  -- 1, X, 2, o2.5, u2.5, yes, no
    odds DECIMAL(4,2),
    scraped_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(match_id, bookmaker, market, selection)
);
```

### Daily Scraping Workflow (8 AM UTC)

**1. Historical Match Results (football-data.org)**
```bash
# Get completed matches for last 7 days
curl -X GET 'https://api.football-data.org/v4/matches?competitions=PL&status=FINISHED&dateFrom=2025-02-05&dateTo=2025-02-12' \
  -H "X-Auth-Token: YOUR_TOKEN"
```
- Store match results (scores, teams, dates) in Postgres
- Update status from "upcoming" to "completed"

**2. Upcoming Matches (OddsHarvester)**
```bash
# Next 7 days with detailed odds
oddsharvester upcoming -s football -l england-premier-league -d 20250213 -m 1x2,over_under,btts --headless
```
- Store upcoming matches with detailed odds (from bookmakers)
- Update odds daily (they change closer to kickoff)

**3. Status Updates**
- Mark upcoming matches that are now completed as 'completed'
- Update scores for newly completed matches

### Design Principles
- League-agnostic: Everything configured in `config.py`, no hardcoded league names
- Date-aware: Use current UTC time to filter completed vs upcoming
- Smart deduplication: Use match_key (league + teams + kickoff) to avoid duplicates
- Incremental updates: Only scrape what changed, don't pull full season daily

### Files Structure
```
/opt/football-odds-scraper/
├── scrape.py              # Main script
├── db_handler.py          # Postgres operations
├── match_processor.py     # Data parsing & deduplication
└── config.py             # League, season, markets config
```

### Next Steps
- Need football-data.org API token (free registration)
- Resolve linking between football-data.org matches and OddsHarvester odds (team names might differ)
- Normalize date formats (ISO8601 from both sources)

### 2026-02-12 Late Session - API Testing

**API Token Setup:**
- API Token: cc99e8aa78b04b7a836ab2065f0fb13c (stored in .secrets.md)
- Base URL: https://api.football-data.org/v4
- Rate limit: 10 requests/minute (free plan)

**Testing Results:**
- Successfully created `/opt/football-odds-scraper/` directory
- Tested Brasileiro Série A (code: BSA) - retrieved 2 upcoming fixtures:
  - Internacional vs Palmeiras (Feb 13, 00:30 UTC)
  - Paranaense vs Corinthians (Feb 19, 22:30 UTC)
- Confirmed: API returns match IDs, kickoff times, team names, team IDs, crests, referees, status
- Limitation: Odds require paid package (only basic 1X2 odds available for free)

**Files Created:**
- `/opt/football-odds-scraper/fixtures_bsa.json` - Sample Brasileirão fixtures
- `/opt/football-odds-scraper/competitions.json` - List of available competitions
- `/opt/football-odds-scraper/fixtures_test.json` - Initial test (empty)

**API Notes:**
- Date range max: 10 days per request
- 13 competitions available in free tier (PL, BSA, CL, SA, PD, BL1, FL1, etc.)
- All top competitions are free forever (TIER_ONE)
